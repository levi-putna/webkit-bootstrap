'use strict';StackExchange.tagEditor=function(e,q,r){function s(){k=!0}function t(a,b){var d=window.tagRendererRaw(a).replace(/<(\/?)a/g,"<$1span").replace(/href='[^>]*/,""),d=$(d);b||d.append('<span class="delete-tag" title="remove this tag"></span>');return d}function D(){var a=g.find(".post-tag").map(function(a,b){return $(b).text()}).get().join(" ");a.length&&(a+=" ");var b=j.find(".post-tag").map(function(a,b){return $(b).text()}).get().join(" ");b.length&&c.val().length&&(b=" "+b);return{text:a+
c.val()+b,lengthBeforeInput:a.length}}function E(){var a=c.val();return(""===a||" "===a)&&0===g.add(j).children().filter(function(){return!/^\s*$/.test($(this).text())}).length}function F(){var a=c.caret();if(g.add(j).find(".post-tag").length){var b=D();c.val(b.text);g.empty();j.empty();c.caret(a.start+b.lengthBeforeInput,a.end+b.lengthBeforeInput);n()}}function o(a){if(!p){var b;b=a?{start:c.val().length,end:c.val().length}:c.caret();-1==b.start&&(b.start=b.end=0);if(b.start!==b.end)F();else{a=c.val().substr(0,
b.start);b=c.val().substr(b.start);a=(a+"!").split(/[,;\s]+/);a[a.length-1]="!"===a[a.length-1]?"":a[a.length-1].slice(0,-1);b=b.split(/[,;\s]+/);var d=a.pop(),f=d.length,d=d+b.shift(),a=sanitizeAndSplitTags(a.join(" "));b=sanitizeAndSplitTags(b.join(" "));var i;for(i=0;i<a.length;i++)t(a[i]).appendTo(g);for(i=0;i<b.length;i++)t(b[i]).appendTo(j);d!==c.val()&&c.val(d);h.find(".post-tag").filter(function(){return/^\s*$/.test($(this).text())}).remove();e.val(D().text);k&&(c.caret(f,f),L())}M()}}function l(a,
b){var d,f;if("string"===typeof a)f=a;else if(a.length)d=a,f=d.text();else return;t(c.val()).appendTo(g);c.val(f);d?(f=$($.unique(d.prevAll(".post-tag").get())),d.nextAll(".post-tag").prependTo(j),f.appendTo(g),d.remove()):j.find(".post-tag").appendTo(g);c.focus();b&&c.caret(0,0)}function G(a){a!==u&&(g.add(c).add(j).css({position:"relative",left:a}),u=a)}function M(){var a;var b=c;a="c_"+b.val();if(a in v)a=v[a];else{var d=$("<span />").css("font-family",b.css("font-family"));d.text(b.val());d.insertAfter(b);
b=d.innerWidth();d.remove();a=v[a]=b}a+=19;d=g.outerWidth();j.children().length||(a=Math.max(a,m-d-8));c.css("width",a);0<d+u&&d+u+a<m||(d+a<m?G(0):G(-d+(m-a)/2))}function H(){w=!0;setTimeout(function(){w=!1},0)}function N(a){var b=a.find("p.more-info");"undefined"===typeof x&&(x=I-5-b.outerWidth());a.find(".post-tag:first").outerWidth()+a.find(".item-multiplier").outerWidth()>x&&b.find("a").text("info")}function J(a,b){$(".tag-suggestions").remove();p=!1;var d=a.length;if(0!==d){for(var c=$("<div class='tag-suggestions' />").css({position:"absolute",
left:h.position().left,top:h.position().top+y+1,width:m-10}).insertAfter(h),i=0;i<a.length;i++){var e=O(a[i],b).appendTo(c).attr("tabindex",z||0);N(e);0===i%3&&e.css("clear","both")}c.delegate("div","keydown",P);c.delegate("div","click",function(a){$(a.target).is("a")||A($(this))});c.delegate("div","focus",function(){w&&1===d?A($(this)):p=!0});c.delegate("div","blur",function(){p=!1})}}function L(){var a=sanitizeAndSplitTags(c.val())[0];B!==a&&(B=a,!a||!a.length?n():Q(a,function(b){a===B&&k&&J(b,
a)}))}function O(a,b){var c=$("<div />").css("width",I).data("tag-name",a.SynonymOf||a.Name);b&&(b=b.replace(/-/g,"").replace(/(.)(?=.)/g,"$1-*").replace(/\+/g,"\\+").replace(/\./g,"\\."));var f=t(a.Name,!0),e=f.html();b&&(e=e.replace(RegExp("("+b+")"),"<span class='match'>$1</span>"));c.append(f.html(e));a.Count&&c.append($("<span class='item-multiplier' />").html("&times;&nbsp;"+a.Count));f="";a.Excerpt&&(f=a.Excerpt);f.length&&c.append($("<p />").text(f));if(a.Synonyms&&a.Synonyms.length)for(var e=
$("<p >also: </p>").appendTo(c),h=a.Synonyms.split(/\|/),g=0;g<h.length;g++)f=h[g],b&&(f=f.replace(RegExp("("+b+")"),"<span class='match'>$1</span>")),0<g&&(f=", "+f),e.append("<span>"+f+"</span>");c.append("<p class='more-info'><a href='/tags/"+encodeURIComponent(a.SynonymOf||a.Name)+"/info' target='_blank'>learn more</a></p>");return c}function Q(a,b){C["t_"+a]?b(C["t_"+a]):K.trigger(a,b)}function A(a){c.val(a.data("tag-name"));n();l("");o()}function n(){$(".tag-suggestions").remove();p=!1;K.cancel()}
function P(a){switch(a.which){case 39:case 40:return $(this).next("div").focus(),!1;case 37:return $(this).prev("div").focus(),!1;case 38:return a=$(this).prev("div"),a.length?a.focus():c.focus(),!1;case 27:return n(),c.focus(),!1;case 13:case 32:return A($(this)),!1}}var k;if("undefined"===typeof r)try{k=e.is(":focus")}catch(S){k=!1}else k=r;e.bind("focus",s);if(e.is(":visible")){e.unbind("focus",s);var m=e.innerWidth(),I=(m-40)/3|0,h=$("<div class='tag-editor' />").css("width",m).insertAfter(e);
e.hide();var r=$("<span class='post-tag'>test</span>").appendTo(h),y=h.innerHeight();r.remove();h.css("height",y);var g=$("<span />").appendTo(h),c=$("<input type='text' tabIndex='0'/>").appendTo(h).val(e.val()+" "),z=e.attr("tabIndex");z&&c.attr("tabIndex",z);var j=$("<span />").appendTo(h),p=!1;c.focus(function(){k=!0;StackExchange.tagEditor.requiredTags&&E()&&J(StackExchange.tagEditor.requiredTags)});c.blur(function(){k=!1;setTimeout(function(){p||(n(),o())},0)});e.focus(function(){c.focus()});
c.keydown(function(a){if(a.shiftKey&&R[a.which]||a.ctrlKey&&65===a.which)return F(),!0;var b=c.caret().start,d=b===c.val().length,e=0===b;switch(a.which){case 37:if(!e)break;l(g.find(".post-tag:last"));return!1;case 39:if(!d)break;l(j.find(".post-tag:first"),!0);return!1;case 8:if(!e)break;a=g.find(".post-tag:last");if(!a.length)return;c.val(a.text()+c.val());c.caret(a.text().length+b);a.remove();return!1;case 46:if(!d)break;a=j.find(".post-tag:first");if(!a.length)return;c.val(c.val()+a.text());
c.caret(b,b);a.remove();return!1;case 36:a=g.find(".post-tag:first");if(!a.length)break;l(a,!0);return!1;case 35:a=j.find(".post-tag:last");if(!a.length)break;l(a);return!1;case 40:return H(),$(".tag-suggestions > div:first").focus(),!1;case 9:H();break;case 27:n();break;case 13:if($(".tag-suggestions").length)return!1}return!0});c.bind("keydown paste click change",function(){setTimeout(function(){o()},0)});h.delegate(".post-tag","click",function(a){var b=$(this);$(a.target).hasClass("delete-tag")&&
b.text("");l(b);o()});h.click(function(a){a.target===this&&(l(""),o())});var v={},u=0,R={35:!0,36:!0,37:!0,38:!0,39:!0,40:!0},w,B,x,C={},K=StackExchange.helpers.DelayedReaction(function(a,b){StackExchange.helpers.addSpinner(h,{position:"absolute",right:10,top:y/2-2});$.get("/filter/tags",{q:a,newstyle:!0},"json").done(function(c){C["t_"+a]=c;StackExchange.helpers.removeSpinner();b(c)})},400,{sliding:!0});o(!0);StackExchange.helpers.genericBindOverlayEvents(h,c,E);StackExchange.tagEditor.ready.resolve();
e[0].func_clear=function(){e.val("");c.val("").blur();h.find(".post-tag").remove()}}else q=q||0,3>q?setTimeout(function(){e.unbind("focus",s);StackExchange.tagEditor(e,q+1,k)},300):(e.unbind("focus",s),StackExchange.debug.log("tag box is invisible, couldn't start tag editor"))};StackExchange.tagEditor.ready=$.Deferred();
